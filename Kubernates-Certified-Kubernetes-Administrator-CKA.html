<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head><meta name="generator" content="Hexo 3.9.0">
    <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="4aJ9pFEKjOcI9zlltw5NYLKMsnk_Ygy49okv3PcTknw">
    <meta name="baidu-site-verification" content="JFD0vIDsbS">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content>
    <meta name="keyword" content>
    <link rel="shortcut icon" href="/img/cat-icon-512.png">
    <!-- Place this tag in your head or just before your close body tag. -->
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <title>
        
          2022年8月 CKA K8s v1.24 考试真题整理 - Yuankun | Zilan
        
    </title>

    <link rel="canonical" href="http://liyuankun.top/Kubernates-Certified-Kubernetes-Administrator-CKA.html">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS --> 
    <!-- <link rel="stylesheet" href="/css/zilan.min.css"> -->
    <link rel="stylesheet" href="/css/zilan.css">
    
    <!-- Pygments Highlight CSS -->
    <link rel="stylesheet" href="/css/highlight.css">

    <link rel="stylesheet" href="/css/widget.css">

    <link rel="stylesheet" href="/css/rocket.css">

    <link rel="stylesheet" href="/css/signature.css">

    <link rel="stylesheet" href="/css/toc.css">

    <link rel="stylesheet" href="/css/share.css">

    <link rel="stylesheet" href="/css/gitment.css">

    <link rel="stylesheet" href="/css/copyright.css">

    <link rel="stylesheet" href="/css/search/localsearch.css">

    <!-- Custom Fonts -->
    <!-- <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="https://cdn.staticfile.org/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script><!-- hexo-inject:begin --><!-- hexo-inject:end -->
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">
	<!-- hexo-inject:begin --><!-- hexo-inject:end --><!-- Post Header -->
<style type="text/css">
    header.intro-header{
        
            background-image: url('');
            /*post*/
        
    }
    
        #signature{
            background-image: url('/img/signature/signature-white.png');
        }
    

    
        #header-cover {
            background-color: rgba(0,0,0,.2);
        }
    
</style>

<header class="intro-header" >
    <div id="header-cover">
        <!-- Signature -->
        <div id="signature">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    
                        <div class="post-heading">
                            <div class="tags">
                                
                                <a class="tag" href="/tags/#Cloud" title="Cloud">Cloud</a>
                                
                                <a class="tag" href="/tags/#container" title="container">container</a>
                                
                            </div>
                            <!-- category post header -->
                            
                                <div class="page-header-category">
                                    <a class="category-list-link" href="/categories/TECH/">TECH</a>►<a class="category-list-link" href="/categories/TECH/container/">container</a>
                                </div>
                            
                            
                                <span class="post-comments-count">
                                    <span class="post-meta-divider">|</span>
                                    <a href="/Kubernates-Certified-Kubernetes-Administrator-CKA.html#git_comment" rel="external nofollow" itemprop="discussionUrl">
                                        <span class="post-meta-item-icon">
                                            <i class="fa fa-comment-o"></i>
                                        </span>
                                        <span class="post-comments-count gitment-comments-count" data-xid="/Kubernates-Certified-Kubernetes-Administrator-CKA.html" itemprop="commentsCount"></span>
                                    </a>
                                </span>
                            
                            <h1>
                                2022年8月 CKA K8s v1.24 考试真题整理
                                <!-- Share -->
                                
                                    <span id="needsharebutton-postbottom" class="header-share">
                                        <span class="btn">
                                            <i class="fa fa-share-alt" aria-hidden="true"></i>
                                        </span>
                                    </span>
                                
                            </h1>
                            <h2 class="subheading">Kubernates-Certified Kubernetes Administrator</h2>
                            <span class="meta">
                                Posted by Yuankun Li on
                                2022-08-02
                            </span>
                        </div>
                    
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>

	
    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">岚</a>
            <!-- Search -->
            
            
                <li class="menu-item menu-item-search">
                
                    <a href="javascript:;" class="popup-trigger">
                
                    
                        <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
                    
                </a>
                </li>
            
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <!-- Known Issue, found by Hux:
            <nav>'s height woule be hold on by its content.
            so, when navbar scale out, the <nav> will cover tags.
            also mask any touch event of tags, unfortunately.
        -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Home</a>
                    </li>

                    

                        
                    

                        
                        <li>
                            <a href="/about/">About</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/archive/">Archives</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/categories/">Categories</a>
                        </li>
                        
                    

                        
                        <li>
                            <a href="/tags/">Tags</a>
                        </li>
                        
                    
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    $toggle.addEventListener('click', handleMagic)
    function handleMagic(e){
        if ($navbar.className.indexOf('in') > 0) {
        // CLOSE
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        }else{
        // OPEN
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }
</script>


    <!-- Main Content -->
    <!-- Post Content -->
<div id="container">
    <article>
        <div class="container post-content-container">
            <div class="row">

                <!-- One Post Content Container -->
                <div class="
                    col-lg-8 col-lg-offset-2
                    col-md-10 col-md-offset-1
                    post-container">

                    <h2 id="考试内容">考试内容</h2>
<p><a href="https://docs.linuxfoundation.org/tc-docs/certification/tips-cka-and-ckad" target="_blank" rel="noopener">Important Instructions: CKA and CKAD</a></p>
<ul>
<li>考试包括 15-20 项performance-based tasks。
<ul>
<li>实测是17道题</li>
</ul>
</li>
<li>考生有 2 小时的时间完成 CKA 和 CKAD 考试。
<ul>
<li>因为从<a href="https://docs.linuxfoundation.org/tc-docs/certification/tips-cka-and-ckad" target="_blank" rel="noopener">06/2022开始环境升级</a>（贬义），考试环境更难用了，变的很卡，所以时间变得比较紧张。容易做不完题，建议先把有把握的，花费时间不多的题先做掉
<ul>
<li><a href="https://itnext.io/cks-cka-ckad-changed-terminal-to-remote-desktop-157a26c1d5e" target="_blank" rel="noopener">CKS CKA CKAD changed Terminal to Remote Desktop </a></li>
<li>2022.9更新，据说很多卡顿的bug已经修复。</li>
</ul>
</li>
</ul>
</li>
<li>2020年9月更新的CKA新版考试66分以上即可通过（原定72分），考试不通过有一次补考机会。</li>
</ul>
<p><img src="https://github.com/CatherineLiyuankun/PictureBed/raw/master/blog/post/CKA/CKA_exam_syllabus.png" alt="CKA"></p>
<h3 id="cka-preparation">CKA Preparation</h3>
<ul>
<li>Read the Curriculum<br>
<a href="https://github.com/cncf/curriculum" target="_blank" rel="noopener">https://github.com/cncf/curriculum</a></li>
<li>Read the Handbook<br>
<a href="https://docs.linuxfoundation.org/tc-docs/certification/If-candidate-handbook" target="_blank" rel="noopener">https://docs.linuxfoundation.org/tc-docs/certification/If-candidate-handbook</a></li>
<li>Read the important tips<br>
<a href="https://docs.linuxfoundation.org/tc-docs/certification/tips-cka-and-ckad" target="_blank" rel="noopener">https://docs.linuxfoundation.org/tc-docs/certification/tips-cka-and-ckad</a></li>
<li>Read the FAQ<br>
<a href="https://docs.linuxfoundation.org/tc-docs/certification/faq-cka-ckad" target="_blank" rel="noopener">https://docs.linuxfoundation.org/tc-docs/certification/faq-cka-ckad</a></li>
</ul>
<!-- > 本文记录的题目大概按照难易程度，先易后难。 -->
<h2 id="如何备考">如何备考</h2>
<h3 id="k8s练习环境">k8s练习环境</h3>
<h4 id="本地环境-minikube">本地环境-Minikube</h4>
<p>可以本地安装<code>Minikube</code>练习， 参考另一篇博客<a href="./Minikube%E5%AE%89%E8%A3%85-MacOS-M1.html">Minikube安装-MacOS M1</a>。</p>
<h4 id="在线环境-killercoda">在线环境-killercoda</h4>
<ul>
<li>k8s 环境： <a href="https://killercoda.com/playgrounds/scenario/kubernetes" target="_blank" rel="noopener">https://killercoda.com/playgrounds/scenario/kubernetes</a></li>
<li>CKA在线练习环境：<a href="https://killercoda.com/killer-shell-cka" target="_blank" rel="noopener">https://killercoda.com/killer-shell-cka</a></li>
<li>CKAD在线练习环境：<a href="https://killercoda.com/killer-shell-ckad" target="_blank" rel="noopener">https://killercoda.com/killer-shell-ckad</a></li>
<li>CKS在线练习环境：<a href="https://killercoda.com/killer-shell-cks" target="_blank" rel="noopener">https://killercoda.com/killer-shell-cks</a></li>
</ul>
<h3 id="cka课程">CKA课程</h3>
<ul>
<li>【需付费】CKA考试-对应官方课程<a href="https://training.linuxfoundation.org/training/kubernetes-fundamentals/" target="_blank" rel="noopener">Kubernetes Fundamentals (LFS258)</a></li>
<li>【需付费】Udemy CKA 课程
<ul>
<li><a href="https://www.techbeatly.com/kk-cka" target="_blank" rel="noopener">Certified Kubernetes Administrator (CKA) – KodeKloud</a> – by Mumshad Mannambeth)</li>
<li><a href="https://www.techbeatly.com/kk-cka-ud" target="_blank" rel="noopener">Certified Kubernetes Administrator (CKA) with Practice Tests – by Mumshad Mannambeth</a> – Udemy</li>
</ul>
</li>
<li>【需付费】Oreilly视频课程: (For beginner or Advanced) <a href="https://learning.oreilly.com/videos/certified-kubernetes-administrator/9780137438419/" target="_blank" rel="noopener">Certified Kubernetes Administrator (CKA), 2nd Ed</a>.
<ul>
<li><a href="https://learning.oreilly.com/live-events/certified-kubernetes-administrator-cka-crash-course/0636920315766/" target="_blank" rel="noopener">Certified Kubernetes Administrator (CKA) Crash Course</a>
<ul>
<li>附带练习环境Practice: <a href="https://learning.oreilly.com/playlists/d6e3fe86-067c-4dc7-a36d-698802d0bdee/" target="_blank" rel="noopener">Certified Kubernetes - CKA Labs</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="经验总结">经验总结</h2>
<ul>
<li><strong>经验1</strong>： 不要完全按照顺序做题！！！Kubernates cluster upgrade 或者 etcd backup 放最后做，否则环境搞坏，其他的题不能做. 隔过去的题可以用flag标记，省的忘记哪些还没有做。</li>
<li><strong>经验2</strong>：  需要在ssh到新的node的时候，在新的tab做题，避免忘记exit出来。</li>
<li>使用<code>kubectl explain</code> 来查看命令内容， 例如<code>kubectl explain pods.spec.tolerations --recursive</code></li>
<li>使用<code>kubectl --help</code> 或<code>kubectl -h</code> 查看命令参数, 例如<code>kubectl create clusterrole --help</code></li>
<li>使用<code>kubectl api-resources</code>, 查看所有资源缩写</li>
<li>考试环境点击<code>-</code>来zoom out, 这样可以显示更多内容。（尤其是使用平板电脑，屏幕太小，显示有效内容很少）。</li>
<li>善用考试记事本（exam notepad）。</li>
<li>复制粘贴
<ul>
<li>What always works: copy+paste using right mouse context menu</li>
<li>What works in Terminal: <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>c</kbd> and <kbd>Ctrl</kbd>+<kbd>Shift</kbd>+<kbd>v</kbd></li>
<li>What works in other apps like Firefox: <kbd>Ctrl</kbd>+<kbd>c</kbd> and <kbd>Ctrl</kbd>+<kbd>v</kbd></li>
</ul>
</li>
<li>可以用<kbd>Tab</kbd>键，自动补全kubectl命令，大大提升效率，以及避免键盘输入拼写错误</li>
<li>考试时间快结束的时候，弹出对话框，问你是否结束考试，一定要点击&quot;Continue&quot;继续考试
<ul>
<li>否则直接结束考试，会引发考试系统的bug： session未能正常close，造成一直无法出成绩。只能通过提ticket来人工解决，才能拿到成绩。</li>
</ul>
</li>
</ul>
<h3 id="常用官方文档链接">常用官方文档链接</h3>
<ul>
<li><a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/" target="_blank" rel="noopener">https://kubernetes.io/docs/reference/kubectl/cheatsheet/</a></li>
<li><a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands" target="_blank" rel="noopener">https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands</a></li>
<li><a href="https://github.com/kubernetes/kubernetes" target="_blank" rel="noopener">https://github.com/kubernetes/kubernetes</a></li>
<li>考试中多使用命令式命令CLI ( imperative commands)，少使用声明式（Declarative）
<ul>
<li><a href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands" target="_blank" rel="noopener">https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands</a></li>
<li><a href="https://medium.com/better-programming/kubernetes-tips-create-pods-with-imperative-commands-in-1-18-62ea6e1ceb32" target="_blank" rel="noopener">https://medium.com/better-programming/kubernetes-tips-create-pods-with-imperative-commands-in-1-18-62ea6e1ceb32</a></li>
<li>Promote the use of generators for Job, CronJob, Network Policies etc: this link is very useful:
<ul>
<li><a href="https://www.linkedin.com/pulse/kubernetes-deep-dive-part-3-generators-quick-poc-atharva-chauthaiwale/" target="_blank" rel="noopener">https://www.linkedin.com/pulse/kubernetes-deep-dive-part-3-generators-quick-poc-atharva-chauthaiwale/</a></li>
</ul>
</li>
<li>Use maximum conventions and best practices to avoid unexpected pod errors:
<ul>
<li><a href="https://unofficial-kubernetes.readthedocs.io/en/latest/user-guide/kubectl-conventions/" target="_blank" rel="noopener">https://unofficial-kubernetes.readthedocs.io/en/latest/user-guide/kubectl-conventions/</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="pre-setup">Pre Setup</h2>
<p>Once you’ve gained access to your terminal it might be wise to spend ~1 minute to setup your environment. You could set these:</p>
<h3 id="kubectl-设置">kubectl 设置</h3>
<p><strong>1. 设置kubectl命令别名</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> k=kubectl                         <span class="comment"># will already be pre-configured </span></span><br><span class="line">                                        <span class="comment"># (2022最新考试环境默认已开启，不用再配置了)</span></span><br><span class="line"><span class="built_in">export</span> <span class="keyword">do</span>=<span class="string">"--dry-run=client -o yaml"</span>    <span class="comment"># k create deploy nginx --image=nginx $do</span></span><br><span class="line">                                        <span class="comment"># k run podname --image=nginx $do &gt; pod.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> now=<span class="string">"--force --grace-period 0"</span>   <span class="comment"># k delete pod x $now</span></span><br><span class="line">                                        <span class="comment"># Don't need to wait ~30 seconds</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用例子</span></span><br><span class="line">k run pod1 --image=httpd:2.4.41-alpine <span class="variable">$do</span> &gt; 2.yaml</span><br></pre></td></tr></table></figure>
<p><strong>Alias Namespace</strong><br>
In addition you could define an alias like:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> kn=<span class="string">'kubectl config set-context --current --namespace</span></span><br></pre></td></tr></table></figure>
<p>Which allows you to define the default namespace of the current context. Then once you switch a context or namespace you can just run:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kn default      <span class="comment"># set default to default</span></span><br><span class="line">kn my-namespace <span class="comment"># set default to my-namespace</span></span><br></pre></td></tr></table></figure>
<p>But only do this if you used it before and are comfortable doing so. Else you need to specify the namespace for every call, which is also fine:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">k -n my-namespace get all</span><br><span class="line">k -n my-namespace get pod</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>如果想使用不同的<code>shell</code>或<code>tmux</code>，可以把这些 alias和变量存入<code>~/.bashrc</code>.</p>
<p><strong>2. <a href="https://kubernetes.io/docs/reference/kubectl/cheatsheet/#kubectl-autocomplete" target="_blank" rel="noopener">开启自动补全autocomplete</a></strong><br>
(2022最新考试环境默认已开启，不用再配置了)</p>
<ul>
<li><code>kubectl --help | grep bash</code>,此步是为了找关键词completion</li>
<li><code>sudo vim /etc/profile</code></li>
<li>添加<code>source &lt;(kubectl completion bash)</code></li>
<li>保存退出，<code>source /etc/profile</code></li>
</ul>
<h3 id="vim-设置"><a href="https://www.ruanyifeng.com/blog/2018/09/vimrc.html" target="_blank" rel="noopener">Vim 设置</a></h3>
<p>复制粘贴 - 从网页上copy yaml内容，使用vim 来粘贴时，yaml内容格式会乱。现在考试环境已经被修复，<code>.vimrc</code> 里面默认加了一些vim粘贴的设置。</p>
<blockquote>
<p>Make sure to set these in your <code>.vimrc</code> or otherwise indents will be very messy during pasting (the exams have these config settings now also by default, but can’t hurt to be able to type them down):</p>
</blockquote>
<p>下面代码中，双引号开始的行表示注释。</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">"1.1 use spaces for tab 由于 Tab 键在不同的编辑器缩进不一致，该设置自动将 Tab 转为空格。</span></span><br><span class="line">:<span class="keyword">set</span> expandtab</span><br><span class="line"></span><br><span class="line"><span class="comment">"1.2 amount of spaces used for tab 按下 Tab 键时，Vim 显示的空格数。</span></span><br><span class="line">:<span class="keyword">set</span> tabstop=<span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">"1.3 amount of spaces used during indentation 在文本上按下&gt;&gt;（增加一级缩进）、&lt;&lt;（取消一级缩进）或者==（取消全部缩进）时，每一级的字符数。</span></span><br><span class="line">:<span class="keyword">set</span> <span class="built_in">shiftwidth</span>=<span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>Save and close the file by pressing <kbd>Esc</kbd> followed by <kbd>:x</kbd> and <kbd>Enter</kbd>.<br>
Whenever you open Vim now as the current user, these settings will be used.<br>
If you ssh onto a different server, these settings will <strong>not</strong> be transferred.</p>
<p><strong>1.3 Indent multiple lines</strong></p>
<p>To indent multiple lines press <kbd>Esc</kbd> and type <code>:set shiftwidth=2</code>.<br>
First mark multiple lines using <kbd>Ctrl</kbd> <kbd>v</kbd>  and the up/down keys. Then to indent the marked lines press <kbd>&gt;</kbd> or <kbd>&lt;</kbd>. You can then press <kbd>.</kbd> to repeat the action.</p>
<p><strong>1.4 Get used to copy/paste/cut with vim:</strong></p>
<figure class="highlight md"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Mark lines: Esc+v (then arrow keys)</span><br><span class="line">Copy marked lines: y</span><br><span class="line">Cut marked lines: d</span><br><span class="line">Past lines: p or P</span><br></pre></td></tr></table></figure>
<p><strong>1.5 <code>:set paste</code></strong></p>
<ul>
<li><code>:set nopaste</code> Turning off auto indent when pasting text into vim</li>
<li><code>:set paste</code> Turning on auto indent when pasting text into vim<br>
<a href="https://vim.fandom.com/wiki/Toggle_auto-indenting_for_code_paste" target="_blank" rel="noopener">Paste toggle</a></li>
</ul>
<p><strong>1.6 显示行号 <code>:set number</code></strong></p>
<p>toggle vim line numbers</p>
<p>When in <code>vim</code> you can press <kbd>Esc</kbd> and type <code>:set number</code> (turn on number) or <code>:set nonumber</code> (turn off number) followed by Enter to toggle line numbers. This can be useful when finding syntax errors based on line - but can be bad when wanting to mark&amp;copy by mouse.<br>
You can also just jump to a line number with <kbd>Esc</kbd> <code>:22</code> + Enter.</p>
<h4 id="vim基本操作"><a href="./Vim%E6%93%8D%E4%BD%9C-%E9%85%8D%E7%BD%AE.html">Vim基本操作</a></h4>
<h3 id="使用nano编辑器"><a href="./nano%E7%BC%96%E8%BE%91%E5%99%A8%E4%BD%BF%E7%94%A8-%E5%BF%AB%E6%8D%B7%E9%94%AE-Linux.html">使用nano编辑器</a></h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 编辑1.yaml文件，如果1.yaml文件不存在则新建</span></span><br><span class="line">nano 1.yaml</span><br><span class="line"><span class="comment"># 粘贴+编辑</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存 control + o</span></span><br><span class="line"><span class="comment"># 退出 control + x</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="考题1-rbac">考题1-RBAC</h2>
<h3 id="rbac题目">RBAC题目</h3>
<p>Task weight: 4%</p>
<p>Set configuration context:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[student@node-1] $ kubectl config use-context k8s</span><br></pre></td></tr></table></figure>
<h4 id="context">Context</h4>
<p>You have been asked to create a new <code>ClusterRole</code> for a deployment pipeline and bind it to a specific <code>ServiceAccount</code> scoped to a specific namespace.</p>
<h4 id="task">Task</h4>
<p>Create a new <code>ClusterRole</code> named <code>deployment-clusterrole</code> which only allows to create the following resource types:</p>
<ul>
<li>Deployment</li>
<li>StatefulSet</li>
<li>DaemonSet</li>
</ul>
<p>Create a new <code>ServiceAccount</code> named <code>cicd-token</code> in the existing namespace <code>app-team1</code>.</p>
<p>Bind the new ClusterRole <code>deployment-clusterrole</code> to the new ServiceAccount <code>cicd-token</code> , limited to the namespace <code>app-team1</code>.</p>
<h3 id="rbac解答">RBAC解答</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">kubectl config use-contex t k8s</span><br><span class="line">$ kubectl create clusterrole deployment-clusterrole --resource=deployments,statefulsets,daemonsets --verb=create</span><br><span class="line"><span class="comment"># $ kubectl create namespace app-team1 # in the existing namespace `app-team1` 所以不需要新建namespace</span></span><br><span class="line">$ kubectl create serviceaccount cicd-token -n app-team1</span><br><span class="line">$ kubectl create rolebinding cicd-token-binding --clusterrole=deployment-clusterrole --serviceaccount=app-team1:cicd-token --namespace=app-team1</span><br><span class="line"><span class="comment"># $ kubectl -n app-team1 describe rolebindings.rbac.authorization.k8s.io cicd-token-binding</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Verify everything using kubectl auth can-i</span></span><br><span class="line">kubectl auth can-i create deployments --as system:serviceaccount:app-team1:cicd-token -n app-team1 <span class="comment"># YES</span></span><br><span class="line">kubectl auth can-i create deployments --as system:serviceaccount:app-team1:cicd-token -n default <span class="comment"># NO</span></span><br><span class="line">kubectl auth can-i delete deployments --as system:serviceaccount:app-team1:cicd-token -n app-team1 <span class="comment"># NO</span></span><br><span class="line">kubectl auth can-i update deployments --as system:serviceaccount:app-team1:cicd-token -n app-team1 <span class="comment"># NO</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="考题2-创建-networkpolicy">考题2-创建 NetworkPolicy</h2>
<h3 id="题目：networkpolicy">题目：NetworkPolicy</h3>
<p>Task weight: 7%</p>
<p>Set configuration context:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[student@node-1] $ kubectl config use-context hk85</span><br></pre></td></tr></table></figure>
<h4 id="task-v2">Task</h4>
<p>Create a new <code>NetworkPolicy</code> named <code>allow-port-from-namespace</code> that allows Pods in the existing<br>
namespace <code>internal</code> to connect to port <code>5768</code> of other Pods in the namespace <code>my-app</code>.</p>
<p>Ensure that the new NetworkPolicy:</p>
<ul>
<li>does not allow access to Pods not listening on port 5768</li>
<li>does not allow access from Pods not in namespace <code>internal</code></li>
</ul>
<h3 id="解答：networkpolicy">解答：NetworkPolicy</h3>
<p>参考<a href="https://kubernetes.io/docs/concepts/services-networking/network-policies/" target="_blank" rel="noopener">官网network-policies</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kubectl config use-context hk8s</span><br><span class="line">kubectl get ns --show-labels <span class="comment"># 得到`internal`的label，例如project=internal</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># kubectl create namespace internal if namespace has no labels</span></span><br><span class="line">kubectl label ns internal project:internal</span><br><span class="line">kubectl label ns my-app project:my-app</span><br><span class="line"></span><br><span class="line">vim allow-port-from-namespace.yaml</span><br><span class="line"><span class="comment"># nano allow-port-from-namespace.yaml</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">NetworkPolicy</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">allow-port-from-namespace</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">internal</span> <span class="comment"># 目的命名空间</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">podSelector:</span> <span class="string">&#123;&#125;</span> <span class="comment"># 加matchLabels会报错</span></span><br><span class="line">  <span class="attr">policyTypes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Ingress</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Egress</span></span><br><span class="line">  <span class="attr">ingress:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">from:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">namespaceSelector:</span></span><br><span class="line">        <span class="attr">matchLabels:</span></span><br><span class="line">          <span class="attr">project:</span> <span class="string">internal</span> <span class="comment"># 命名空间label</span></span><br><span class="line">  <span class="attr">egress:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">to:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">namespaceSelector:</span></span><br><span class="line">            <span class="attr">matchLabels:</span></span><br><span class="line">              <span class="attr">project:</span> <span class="string">my-app</span> <span class="comment"># 命名空间label</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">5768</span> <span class="comment"># 允许访问的端口</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f allow-port-from-namespace.yaml</span><br><span class="line">kubectl get networkpolicies.networking.k8s.io -n internal</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="考题3-创建-svc">考题3-创建 svc</h2>
<h3 id="题目：创建-svc">题目：创建 svc</h3>
<p>Task weight: 7%</p>
<p>Set configuration context:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[student@node-1] $ kubectl config use-context k8S</span><br></pre></td></tr></table></figure>
<h4 id="task-v3">Task</h4>
<p>Reconfigure the existing deployment <code>front-end</code> and add a port specification named <code>http</code> exposing port <code>80/tcp</code> of the existing container <code>nginx</code>.</p>
<p>Create a new service named <code>front-end-svc</code> exposing the container port <code>http</code>.</p>
<p>Configure the new service to also expose the individual Pods via a <code>NodePort</code> on the nodes on which they are scheduled.</p>
<h3 id="解答：创建-svc">解答：创建 svc</h3>
<p>search “containerPort”, 参考<a href="https://kubernetes.io/docs/concepts/services-networking/connect-applications-service/" target="_blank" rel="noopener">Connecting Applications with Services</a><br>
<a href="https://kubernetes.io/docs/tasks/configure-pod-container/_print/" target="_blank" rel="noopener">configure-pod-container</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl config use-context k8S</span><br><span class="line"></span><br><span class="line">kubectl get deployment front-end <span class="comment"># 可选</span></span><br><span class="line">kubectl edit deployment front-end</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span> <span class="comment"># 添加port name</span></span><br><span class="line">      <span class="attr">containerPort:</span> <span class="number">80</span> <span class="comment"># 添加containerPort</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span> <span class="comment"># 添加protocol</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl expose deployment front-end --name=front-end-svc --port=80 --target-port=80 --protocol=TCP --<span class="built_in">type</span>=NodePort</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="考题4-创建-ingress-资源">考题4-创建 ingress 资源</h2>
<h3 id="题目：ingress">题目：ingress</h3>
<p>Task weight: 7%<br>
Set configuration context:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[student@node-1] $ kubectl config use-context k85</span><br></pre></td></tr></table></figure>
<h4 id="task-v4">Task</h4>
<p>Create a new nginx Ingress resource as follows:</p>
<ul>
<li>Name: <code>pong</code></li>
<li>Namespace: <code>ing-internal</code></li>
<li>Exposing service <code>hi</code> on path <code>/hi</code> using service port <code>5678</code></li>
</ul>
<blockquote>
<p>The availability of service <code>hi</code> can be checked using the following command, which should return <code>hi</code>:<br>
<code>[student@node-11 $ curl -kl &lt;INTERNAL_IP&gt;/hi</code></p>
</blockquote>
<h3 id="解答：ingress">解答：ingress</h3>
<p>参考<a href="https://kubernetes.io/docs/concepts/services-networking/ingress/" target="_blank" rel="noopener">ingress</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kubectl config use-context k85</span><br><span class="line"><span class="comment"># Find out the ingressClassName with:</span></span><br><span class="line">kubectl get ingressclass</span><br><span class="line">NAME    CONTROLLER             PARAMETERS   AGE</span><br><span class="line">nginx   k8s.io/ingress-nginx   &lt;none&gt;       22</span><br><span class="line"></span><br><span class="line">vim pong.yaml</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">networking.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pong</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ing-internal</span>  <span class="comment"># Add： The Ingress resources needs to be created in the same Namespace as the applications.</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">"nginx"</span>   <span class="comment"># 要加这句或者加spec.ingressClassName，不然kubctl get ingress 不出来address</span></span><br><span class="line">    <span class="comment"># this annotation removes the need for a trailing slash when calling urls</span></span><br><span class="line">    <span class="comment"># but it is not necessary for solving this scenario</span></span><br><span class="line">    <span class="attr">nginx.ingress.kubernetes.io/rewrite-target:</span> <span class="string">/</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ingressClassName:</span> <span class="string">nginx</span> <span class="comment"># 要加这句，不然kubctl get ingress 不出来address</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/hi</span></span><br><span class="line">        <span class="attr">pathType:</span> <span class="string">Prefix</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">service:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">hi</span></span><br><span class="line">            <span class="attr">port:</span></span><br><span class="line">              <span class="attr">number:</span> <span class="number">5678</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f pong.yaml</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取 ingress 的 IP 地址</span></span><br><span class="line">$ kubectl get pod -n ing-internal -o wide</span><br><span class="line">kubctl get ingress -n ing-internal</span><br><span class="line"></span><br><span class="line"><span class="comment"># 验证</span></span><br><span class="line">$ curl -kl &lt;INTERNAL_IP&gt;/hi</span><br><span class="line"><span class="comment"># 返回 hi 即为成功</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方法2</span></span><br><span class="line">kubectl config use-context k85</span><br><span class="line">kubectl create ingress pong -n ing-internal --rule=<span class="string">"/hi*=hi:5678"</span></span><br><span class="line"></span><br><span class="line">annotations:</span><br><span class="line">    nginx.ingress.kubernetes.io/rewrite-target: /</span><br><span class="line">    nginx.ingress.kubernetes.io/ssl-redirect: <span class="string">"false"</span></span><br><span class="line">    kubernetes.io/ingress.class: <span class="string">"nginx"</span></span><br><span class="line"></span><br><span class="line">kubectl get ingress -n ing-internal</span><br><span class="line"><span class="comment"># kubectl get svc</span></span><br><span class="line">curl -kl &lt;INTERNAL_IP&gt;/hi</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="考题5-扩展-deployment">考题5-扩展 deployment</h2>
<h3 id="题目：扩展-deployment">题目：扩展 deployment</h3>
<p>Task weight: 4%<br>
难易程度： 简单<br>
Set configuration context:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[student@node-1] $ kubectl config use-context k8s</span><br></pre></td></tr></table></figure>
<h4 id="task-v5">Task</h4>
<p>Scale the deployment <code>loadbalancer</code> to <code>6</code> pods.</p>
<h3 id="解答：扩展-deployment">解答：扩展 deployment</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl scale deployment loadbalancer --replicas=6</span><br><span class="line">kubectl get deployment loadbalancer</span><br><span class="line">kubectl get pods</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="考题6-将-pod-部署到指定-node-节点上">考题6-将 pod 部署到指定 node 节点上</h2>
<h3 id="题目：将-pod-部署到指定-node-节点上">题目：将 pod 部署到指定 node 节点上</h3>
<p>难易程度： 简单<br>
Task weight: 4%</p>
<p>Set configuration context:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[student@node-1] $ kubectl config use-context k8s</span><br></pre></td></tr></table></figure>
<h4 id="task-v6">Task</h4>
<p>Schedule a pod as follows:</p>
<ul>
<li>Name: <code>nginx-kuSc00401</code></li>
<li>Image: <code>nginx</code></li>
<li>Node selector: <code>disk=spinning</code></li>
</ul>
<h3 id="解答：将-pod-部署到指定-node-节点上">解答：将 pod 部署到指定 node 节点上</h3>
<p>参考官方文档： <a href="https://kubernetes.io/docs/tasks/configure-pod-container/assign-pods-nodes/#create-a-pod-that-gets-scheduled-to-your-chosen-node" target="_blank" rel="noopener">Assigning Pods to Nodes</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl config use-context k8s</span><br><span class="line">kubectl run nginx-kuSc00401 --image=nginx --dry-run=client -o yaml &gt; nginx-kusc00401.yaml</span><br><span class="line">vim nginx-kusc00401.yaml</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-kusc00401</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">  <span class="attr">nodeSelector:</span> <span class="comment"># 添加nodeSelector</span></span><br><span class="line">    <span class="attr">disk:</span> <span class="string">spinning</span> <span class="comment"># 添加node label</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f nginx-kusc00401.yaml</span><br><span class="line">kubectl get pod nginx-kusc00401 -o wide</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="考题7-kubernates-upgrade">考题7-Kubernates-upgrade</h2>
<h3 id="题目：-kubernates-upgrade">题目： Kubernates-upgrade</h3>
<p>Task weight: 7%</p>
<p>Set configuration context:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[student@node -1] $ kubectl config use-context mk85</span><br></pre></td></tr></table></figure>
<h4 id="task-v7">Task</h4>
<p>Given an existing Kubernetes cluster running version <code>1.24.1</code>, upgrade all of the Kubernetes control plane and node components on the master node only to version <code>1.24.2</code>.</p>
<p>You are also expected to upgrade kubelet and kubectl on the <strong>master</strong> node.</p>
<blockquote>
<p>Be sure to drain the master node before upgrading it and uncordon it after the upgrade.<br>
Do not upgrade the worker nodes, etcd, the container manager, the CNI plugin, the DNS service or any other addons.</p>
</blockquote>
<h3 id="解答：升级master">解答：升级master</h3>
<p>参考官方文档： <a href="https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/" target="_blank" rel="noopener">kubernetes-upgrade kubeadm</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl config use-context mk8s</span><br><span class="line">$ kubectl get nodes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 腾空节点</span></span><br><span class="line">$ kubectl drain mk8s-master-1 --ignore-daemonsets <span class="comment"># --delete-local-data</span></span><br><span class="line"></span><br><span class="line">$ ssh mk8s-master-1</span><br><span class="line">$ sudo -i</span><br><span class="line"></span><br><span class="line"><span class="comment"># 升级kubeadm</span></span><br><span class="line">[root@mk8s-master-1] apt-get update &amp;&amp; apt-get install -y kubeadm=1.24.2-00</span><br><span class="line">[root@mk8s-master-1] kubeadm version</span><br><span class="line">[root@mk8s-master-1] kubeadm upgrade plan</span><br><span class="line"><span class="comment"># 查看etcd参数</span></span><br><span class="line">[root@mk8s-master-1] kubeadm upgrade apply -h | grep etcd</span><br><span class="line"></span><br><span class="line">[root@mk8s-master-1] kubeadm upgrade apply v1.22.2 --etcd-upgrade=<span class="literal">false</span> <span class="comment"># 注意Do not upgrade the worker nodes, etc, the container manager, the CNI plugin, the DNS service or any other addons.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 升级 kubelet 和 kubectl </span></span><br><span class="line">[root@mk8s-master-1] kubectl version</span><br><span class="line">[root@mk8s-master-1] kubelet --version</span><br><span class="line"></span><br><span class="line">[root@mk8s-master-1] apt-get update &amp;&amp; apt-get install -y kubelet=1.24.2-00 kubectl=1.24.2-00</span><br><span class="line"><span class="comment">## 重启</span></span><br><span class="line">[root@mk8s-master-1] sudo systemctl daemon-reload</span><br><span class="line">[root@mk8s-master-1] sudo systemctl restart kubelet</span><br><span class="line">[root@mk8s-master-1] kubelet --version</span><br><span class="line"></span><br><span class="line"><span class="comment"># 解除节点的保护</span></span><br><span class="line">[root@mk8s-master-1] kubectl uncordon mk8s-master-1</span><br><span class="line">[root@mk8s-master-1] kubectl get node <span class="comment"># (确认只升级了 master 节点到 1.24.2 版本)</span></span><br><span class="line"></span><br><span class="line">[root@mk8s-master-1] <span class="built_in">exit</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="考题8-etcd-备份还原">考题8-etcd 备份还原</h2>
<h3 id="题目：etcd-备份还原">题目：etcd 备份还原</h3>
<p>(1.20 版本需要把端口号从 2739 改成 2830)<br>
Task weight: 7%</p>
<p>No configuration context change required for this item.</p>
<h4 id="task-v8">Task</h4>
<p>First, create a snapshot of the existing <code>etc</code> instance running at <code>https://127.0.0.1:2379</code>, saving the snapshot to <code>/srv/data/etcd-snapshot.db</code>.</p>
<blockquote>
<p>Creating a snapshot of the given instance is expected to complete in seconds.<br>
If the operation seems to hang, something’s likely wrong with your command. Use <kbd>CTRL</kbd>+ <kbd>C</kbd> to cancel the operation and try again.</p>
</blockquote>
<p>Next, restore an existing, previous snapshot located at<br>
<code>/var/lib/backup/etcd-snapshot-previous.db</code>.</p>
<blockquote>
<p>The following TLS certificates/key are supplied for<br>
connecting to the server with <code>etcdctl</code>:</p>
<ul>
<li>CA certificate: <code>/opt/KUIN00601/ca.crt</code></li>
<li>Client certificate: <code>/opt/KUIN00601/etcd-client.crt</code></li>
<li>Client key: <code>/opt/KUIN00601/etcd-client.key</code></li>
</ul>
</blockquote>
<h3 id="解答">解答</h3>
<p>Search <code>etcd backup</code>, 选择 <a href="https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/#backing-up-an-etcd-cluster" target="_blank" rel="noopener">Operating etcd clusters for Kubernetes</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1 backup</span></span><br><span class="line"><span class="comment">## 1.0 如果记不清参数，可查看帮助</span></span><br><span class="line">etcdctl snapshot save --<span class="built_in">help</span></span><br><span class="line"><span class="comment">### 1.0.1 [本题目中无需这一步]如果题目中没有给出certificates/key 可从/etc/kubernetes/manifests/etcd.yaml里查找</span></span><br><span class="line">➜ root@cluster3-master1:~<span class="comment"># vim /etc/kubernetes/manifests/etcd.yaml</span></span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/kubernetes/manifests/etcd.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="literal">null</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">component:</span> <span class="string">etcd</span></span><br><span class="line">    <span class="attr">tier:</span> <span class="string">control-plane</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">etcd</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">command:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">etcd</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--advertise-client-urls=https://192.168.100.31:2379</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--cert-file=/etc/kubernetes/pki/etcd/server.crt</span>                   <span class="comment"># use as --cert</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--client-cert-auth=true</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--data-dir=/var/lib/etcd</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--initial-advertise-peer-urls=https://192.168.100.31:2380</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--initial-cluster=cluster3-master1=https://192.168.100.31:2380</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--key-file=/etc/kubernetes/pki/etcd/server.key</span>                    <span class="comment"># use as --key</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--listen-client-urls=https://127.0.0.1:2379,https://192.168.100.31:2379</span> <span class="comment"># use as --endpoints</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--listen-metrics-urls=http://127.0.0.1:2381</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--listen-peer-urls=https://192.168.100.31:2380</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--name=cluster3-master1</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--peer-cert-file=/etc/kubernetes/pki/etcd/peer.crt</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--peer-client-cert-auth=true</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--peer-key-file=/etc/kubernetes/pki/etcd/peer.key</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--peer-trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt</span>               <span class="comment"># use as --cacert</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--snapshot-count=10000</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">--trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">k8s.gcr.io/etcd:3.3.15-0</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">    <span class="attr">livenessProbe:</span></span><br><span class="line">      <span class="attr">failureThreshold:</span> <span class="number">8</span></span><br><span class="line">      <span class="attr">httpGet:</span></span><br><span class="line">        <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/health</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">2381</span></span><br><span class="line">        <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">      <span class="attr">initialDelaySeconds:</span> <span class="number">15</span></span><br><span class="line">      <span class="attr">timeoutSeconds:</span> <span class="number">15</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">etcd</span></span><br><span class="line">    <span class="attr">resources:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/var/lib/etcd</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">etcd-data</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/etc/kubernetes/pki/etcd</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">etcd-certs</span></span><br><span class="line">  <span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">priorityClassName:</span> <span class="string">system-cluster-critical</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/etc/kubernetes/pki/etcd</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">etcd-certs</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/var/lib/etcd</span>                                     <span class="comment"># important</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">etcd-data</span></span><br><span class="line"><span class="attr">status:</span> <span class="string">&#123;&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### 1.0.2 [本题目中无需这一步] 或者1.0.1可用1.0.2取代</span></span><br><span class="line"><span class="comment"># But we also know that the api-server is connecting to etcd, so we can check how its manifest is configured:</span></span><br><span class="line">root@cluster3-master1:~ cat /etc/kubernetes/manifests/kube-apiserver.yaml | grep etcd</span><br><span class="line">- --etcd-cafile=/etc/kubernetes/pki/etcd/ca.crt</span><br><span class="line">- --etcd-certfile=/etc/kubernetes/pki/apiserver-etcd-client.crt</span><br><span class="line">- --etcd-keyfile=/etc/kubernetes/pki/apiserver-etcd-client.key</span><br><span class="line">- --etcd-servers=https://127.0.0.1:2379</span><br><span class="line"></span><br><span class="line"><span class="comment">## 1.1 backup snapshot</span></span><br><span class="line">ETCDCTL_API=3 etcdctl snapshot save /srv/data/etcd-snapshot.db \</span><br><span class="line">--cacert=/opt/KUIN00601/ca.crt \</span><br><span class="line">--cert=/opt/KUIN00601/etcd-client.crt \</span><br><span class="line">--key=/opt/KUIN00601/etcd-client.key \</span><br><span class="line">--endpoints=https://127.0.0.1:2379</span><br><span class="line"></span><br><span class="line">Snapshot saved at /srv/data/etcd-snapshot.db</span><br><span class="line"></span><br><span class="line"><span class="comment"># <span class="doctag">NOTE:</span> Dont use `snapshot status` because it can alter the snapshot file and render it invalid</span></span><br><span class="line"><span class="comment"># 1.2 接着既可以检查下你备份的文件:</span></span><br><span class="line"><span class="comment"># ETCDCTL_API=3 etcdctl --write-out=table snapshot status /srv/data/etcd-snapshot.db</span></span><br><span class="line"><span class="comment"># #有以下输出，就没问题</span></span><br><span class="line"><span class="comment"># +----------+----------+------------+------------+ </span></span><br><span class="line"><span class="comment"># | HASH | REVISION | TOTAL KEYS | TOTAL SIZE |</span></span><br><span class="line"><span class="comment"># +----------+----------+------------+------------+ </span></span><br><span class="line"><span class="comment"># | fe01cf57 | 10 | 7 | 2.1 MB </span></span><br><span class="line"><span class="comment"># | +----------+----------+------------+------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 restore</span></span><br><span class="line"><span class="comment">## 2.1 Next we stop all controlplane components:</span></span><br><span class="line">root@cluster3-master1:~ <span class="built_in">cd</span> /etc/kubernetes/manifests/</span><br><span class="line">root@cluster3-master1:/etc/kubernetes/manifests<span class="comment"># mv * ..</span></span><br><span class="line">root@cluster3-master1:/etc/kubernetes/manifests<span class="comment"># watch crictl ps</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 2.2 restore snapshot into a specific directory: /var/lib/etcd-backup</span></span><br><span class="line">ETCDCTL_API=3 etcdctl snapshot restore /var/lib/backup/etcd-snapshot-previous.db \</span><br><span class="line">--data-dir /var/lib/etcd-backup \</span><br><span class="line">--cacert=/opt/KUIN00601/ca.crt \</span><br><span class="line">--cert=/opt/KUIN00601/etcd-client.crt \</span><br><span class="line">--key=/opt/KUIN00601/etcd-client.key </span><br><span class="line"></span><br><span class="line">2022-08-04 16:50:19.650804 I | mvcc: restore compact to 9935</span><br><span class="line">2022-08-04 16:50:19.659095 I | etcdserver/membership: added member 8e9e05c52164694d [http://localhost:2380] to cluster</span><br><span class="line">cdf818194e3a8c32</span><br><span class="line"></span><br><span class="line"><span class="comment"># We could specify another host to make the backup from by using `etcdetl --endpoints http: //IP`, but here we just use the default value</span></span><br><span class="line"><span class="comment"># which is: `http://127.0.0.1:2379,http://127.0.0.1:4001`</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 2.3  </span></span><br><span class="line"><span class="comment">## The restored files are located at the new folder `/var/lib/eted-backup`, now we have to tell etcd to use that directory:</span></span><br><span class="line">root@cluster3-master1:~ vim /etc/kubernetes/etcd.yaml</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /etc/kubernetes/etcd.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">creationTimestamp:</span> <span class="literal">null</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">component:</span> <span class="string">etcd</span></span><br><span class="line">    <span class="attr">tier:</span> <span class="string">control-plane</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">etcd</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"><span class="attr">spec:</span> <span class="string">...</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">/etc/kubernetes/pki/etcd</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">etcd-certs</span></span><br><span class="line">  <span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">priorityClassName:</span> <span class="string">system-cluster-critical</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/etc/kubernetes/pki/etcd</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">etcd-certs</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hostPath:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/var/lib/etcd-backup</span>               <span class="comment"># change</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">etcd-data</span></span><br><span class="line"><span class="attr">status:</span> <span class="string">&#123;&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 2.4</span></span><br><span class="line"><span class="comment"># Now we move all controlplane yaml again into the manifest directory. </span></span><br><span class="line"><span class="comment"># Give it some time (up to several minutes) for eted to restart and for the api-server to be reachable again:</span></span><br><span class="line">root@cluster3-master1:~ <span class="built_in">cd</span> /etc/kubernetes/manifests/</span><br><span class="line">root@cluster3-master1:/etc/kubernetes/manifests<span class="comment"># mv ../*.yaml .</span></span><br><span class="line">root@cluster3-master1:/etc/kubernetes/manifests<span class="comment"># watch crictl ps</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="考题9-创建多个-container-的-pod">考题9-创建多个 container 的 Pod</h2>
<h3 id="题目：创建多个-container-的-pod">题目：创建多个 container 的 Pod</h3>
<p>难易程度： 简单<br>
Task weight: 4%</p>
<p>Set configuration context:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[student@node-1] $ kubectl config use-context k8s</span><br></pre></td></tr></table></figure>
<h4 id="task-v9">Task</h4>
<p>Create a pod named <code>kucc1</code> with a single app container for each of the following images running inside (there may be between 1 and 4 images specified): <code>nginx + redis + memcached + consul</code>.</p>
<h3 id="解答：创建多个-container-的-pod">解答：创建多个 container 的 Pod</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl config use-context k8s</span><br><span class="line"></span><br><span class="line">kubectl run kucc1 --image nginx --dry-run=client -o yaml &gt; kucc1.yaml</span><br><span class="line">vim kucc1.yaml</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">kucc1</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">redis</span> <span class="comment"># Add 1 </span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">memcached</span> <span class="comment"># Add 2</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">memcached</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">consul</span> <span class="comment"># Add 3</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">consul</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f kucc1.yaml</span><br><span class="line"><span class="comment"># kubectl describe pods kucc1</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="考题10-创建-persistent-volume">考题10-创建 Persistent Volume</h2>
<h3 id="题目：创建-persistent-volume">题目：创建 Persistent Volume</h3>
<p>Task weight: 4%</p>
<p>Set configuration context:<br>
<code>[student@node-1] $ kubectl config use-context hk85</code></p>
<h4 id="task-v10">Task</h4>
<p>Create a persistent volume with name <code>app-config</code>, of capacity <code>2Gi</code> and access mode <code>ReadWriteMany</code>. The type of volume is<br>
<code>hostPath</code> and its location is <code>/srv/app-config</code>.</p>
<h3 id="解答：创建-persistent-volume">解答：创建 Persistent Volume</h3>
<p>参考官方文档： <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-persistent-volume-storage/#create-a-persistentvolume" target="_blank" rel="noopener">example of hostPath typed volume</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl config use-context hk85</span><br><span class="line">vim app-config.yaml</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">app-config</span> <span class="comment"># name</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">2Gi</span> <span class="comment"># capacity 2Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteMany</span> <span class="comment"># ReadWriteMany</span></span><br><span class="line">  <span class="attr">hostPath:</span> <span class="comment"># hostPath</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">"/srv/app-config"</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f app-config.yaml</span><br><span class="line">kubectl get pv</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="考题11-创建-pvc">考题11-创建 PVC</h2>
<h3 id="题目：创建-pvc">题目：创建 PVC</h3>
<p>Task weight: 7%</p>
<p>Set configuration context:<br>
<code>[student@node-1] $ kubectl config use-context ok85</code></p>
<h4 id="task-v11">Task</h4>
<p>Create a new <code>PersistentVolumeClaim</code>:</p>
<ul>
<li>Name: pv-volume</li>
<li>Class: csi-hostpath-sc</li>
<li>Capacity: 10Mi</li>
</ul>
<hr>
<p>Create a new Pod which mounts the <code>PersistentVolumeClaim</code> as a volume:</p>
<ul>
<li>Name: web-server</li>
<li>Image: nginx</li>
<li>Mount path: /usr/share/nginx/html</li>
</ul>
<p>Configure the new Pod to have <code>ReadWriteOnce</code> access on the volume.</p>
<hr>
<p>Finally, using <code>kubectl edit</code> or <code>kubectl patch</code> expand the <code>PersistentVolumeClaim</code> to a capacity of <code>70Mi</code> and record that change.</p>
<h3 id="解答：创建-pvc">解答：创建 PVC</h3>
<p>参考官方文档：</p>
<ul>
<li>搜索 <code>PV pod</code>, 选择<a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-persistent-volume-storage/#create-a-persistentvolumeclaim" target="_blank" rel="noopener">&quot;Configure a Pod to Use a PersistentVolume for Storage | Kubernetes&quot;</a>
<ul>
<li><a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-persistent-volume-storage/#create-a-persistentvolumeclaim" target="_blank" rel="noopener">Create a PersistentVolumeClaim</a></li>
<li><a href="https://kubernetes.io/zh-cn/docs/tasks/configure-pod-container/configure-persistent-volume-storage/" target="_blank" rel="noopener">Configure a Pod …中文文档</a></li>
</ul>
</li>
<li>搜索 <code>kubectl edit pvc</code> <a href="https://kubernetes.io/blog/2018/07/12/resizing-persistent-volumes-using-kubernetes/" target="_blank" rel="noopener">Resizing Persistent Volumes using Kubernetes</a>
<ul>
<li><a href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/#expanding-persistent-volumes-claims" target="_blank" rel="noopener">expanding-persistent-volumes-claims</a></li>
</ul>
</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl config use-context hk85</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1 创建PVC</span></span><br><span class="line">nano pv-volume.yaml</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pv-volume</span> <span class="comment"># 1 name</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span> <span class="comment"># 2 ReadWriteOnce</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">10Mi</span> <span class="comment"># 3</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">csi-hostpath-sc</span> <span class="comment"># 4</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f pv-volume.yaml</span><br><span class="line">kubectl get pvc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 创建pod</span></span><br><span class="line">nano web-server.yaml</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">web-server</span> <span class="comment"># pod name</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">volumes:</span>                  <span class="comment"># add</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">task-pv-storage</span> <span class="comment"># add</span></span><br><span class="line">      <span class="attr">persistentVolumeClaim:</span> <span class="comment"># add</span></span><br><span class="line">        <span class="attr">claimName:</span> <span class="string">pv-volume</span> <span class="comment"># PVC name, 要与之前一致</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">"http-server"</span></span><br><span class="line">      <span class="attr">volumeMounts:</span>                          <span class="comment"># add</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">"/usr/share/nginx/html"</span> <span class="comment"># mountPath</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">task-pv-storage</span>              <span class="comment"># 和spec.volumes.name一致</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f web-server.yaml</span><br><span class="line">kubectl get pods</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3 Edit PVC</span></span><br><span class="line">kubectl edit pvc pv-volume --record</span><br><span class="line"><span class="comment"># 修改 storage: 10Mi 为 storage: 70Mi</span></span><br></pre></td></tr></table></figure>
<h2 id="考题12-设置node-unavailable">考题12-设置node unavailable</h2>
<h3 id="题目：设置node-unavailable">题目：设置node unavailable</h3>
<p>Task weight: 4%<br>
难易程度： 简单</p>
<p>Set configuration context：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[student@node-1] $ kubectl config use-context ek85</span><br></pre></td></tr></table></figure>
<h4 id="task-v12">Task</h4>
<p>Set the node named <code>ek8s-node-1</code> as unavailable and reschedule all the pods running on it.</p>
<h3 id="解答：设置node-unavailable">解答：设置node unavailable</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl config use-context ek85</span><br><span class="line">kubectl get nodes</span><br><span class="line">kubectl drain ek8s-node-1 --ignore-daemonsets --delete-emptydir-data <span class="comment"># 不加--delete-emptydir-data会报错。可选参数：--delete-local-data --force</span></span><br><span class="line"><span class="comment"># kubectl uncordon ek8s-node-1 # 应该不需要这行</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="考题13-监控-pod-的日志">考题13-监控 pod 的日志</h2>
<h3 id="题目：监控-pod-的日志">题目：监控 pod 的日志</h3>
<p>难易程度： 简单<br>
Task weight: 5%<br>
Set configuration context:<br>
<code>[student@node-1] $ kubectl config use-context k8s</code></p>
<h4 id="task-v13">Task</h4>
<p>Monitor the logs of pod <code>foobar</code> and:</p>
<ul>
<li>Extract log lines corresponding to error <code>unable-to-access-website</code></li>
<li>Write them to <code>/opt/KUTR00101/foobar</code></li>
</ul>
<h3 id="解答：监控-pod-的日志">解答：监控 pod 的日志</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl config use-context k8s</span><br><span class="line">kubectl logs foobar | grep unable-to-access-website &gt; /opt/KUTR00101/foobar</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="考题14-查看最高-cpu-使用率的-pod">考题14-查看最高 CPU 使用率的 Pod</h2>
<h3 id="题目：查看最高-cpu-使用率的-pod">题目：查看最高 CPU 使用率的 Pod</h3>
<p>Task weight: 5%<br>
难易程度： 简单</p>
<p>Set configuration context:<br>
<code>[student@node-1] $ kubectl config use-context k8s</code></p>
<h4 id="task-v14">Task</h4>
<p>From the pod label <code>name=cpu-user</code>, find pods running high CPU workloads and write the name of the pod consuming most<br>
CPU to the file <code>/opt/KUTR00401/KUTR00401.txt</code> (which already exists).</p>
<h3 id="解答：查看最高-cpu-使用率的-pod">解答：查看最高 CPU 使用率的 Pod</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">kubectl top pod -l name=cpu-user -A --sort-by=cpu</span><br><span class="line"></span><br><span class="line">    NAMAESPACE NAME  CPU MEM</span><br><span class="line">          cpu-user-1 45m 6Mi</span><br><span class="line">          cpu-user-2 38m 6Mi </span><br><span class="line">          cpu-user-3 35m 7Mi </span><br><span class="line">          cpu-user-4 32m 10Mi</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'cpu-user-1'</span> &gt; /opt/KUTR00401/KUTR00401.txt</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="考题15-集群故障排查">考题15-集群故障排查</h2>
<h3 id="题目：集群故障排查">题目：集群故障排查</h3>
<p>Task weight: 13%</p>
<p>Set configuration context:<br>
<code>[student@node-1] $ kubectl config use-context wk8s</code></p>
<h4 id="task-v15">Task</h4>
<p>A Kubernetes worker node, named <code>wk8s-node-O</code> is in state <code>NotReady</code>.<br>
Investigate why this is the case, and perform any appropriate steps to bring the node to a <code>Ready</code> state, ensuring that any<br>
changes are made permanent.</p>
<h3 id="解答：集群故障排查">解答：集群故障排查</h3>
<p>Search <code>systemctl restart</code>, 选择<a href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/troubleshooting-kubeadm/" target="_blank" rel="noopener">Troubleshooting kubeadm</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">kubectl get nodes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接worker node</span></span><br><span class="line">ssh wk8s-node-O</span><br><span class="line"><span class="comment"># 获取sudo权限</span></span><br><span class="line">sudo -i</span><br><span class="line"><span class="comment"># 查看服务是否正常运行</span></span><br><span class="line">systemctl status kubelet</span><br><span class="line"><span class="comment"># 服务重启</span></span><br><span class="line">systemctl restart kubelet</span><br><span class="line"><span class="comment"># 设置开机自动启动</span></span><br><span class="line">systemctl <span class="built_in">enable</span> kubelet</span><br><span class="line"><span class="comment"># 查看服务是否正常运行</span></span><br><span class="line">systemctl status kubelet</span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>
<hr>
<h2 id="考题16-添加-sidecar-container">考题16-添加 sidecar container</h2>
<h3 id="题目：添加-sidecar-container">题目：添加 sidecar container</h3>
<p>Task weight: 7%</p>
<p>Set configuration context:<br>
<code>[student@node-1] $ kubectl config use-context k8s</code></p>
<h4 id="context-v2">Context</h4>
<p>Without changing its existing containers, an existing Pod needs to be integrated into Kubernetes’s built-in logging architecture (e.g. kubectl logs). Adding a streaming sidecar container is a good and common way to accomplish this requirement.</p>
<h4 id="task-v16">Task</h4>
<p>Add a <code>busybox</code> sidecar container to the existing Pod <code>legacy-app</code>. The new sidecar container has to run the following command:<br>
<code>/bin/sh -c tail -n+l -f /var/log/legacy-app.log</code></p>
<p>Use a volume mount named <code>logs</code> to make the file <code>/var/log/legacy-app.log</code> available to the sidecar container.</p>
<blockquote>
<p>Don’t modify the existing container.<br>
Don’t modify the path of the log file, both containers<br>
must access it at <code>/var/log/legacy-app.log</code></p>
</blockquote>
<h3 id="解答：添加-sidecar-container">解答：添加 sidecar container</h3>
<p>官网Search <code>Logging</code>, 选择<a href="https://kubernetes.io/docs/concepts/cluster-administration/logging/" target="_blank" rel="noopener">Logging Architecture</a>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl config use-context k8s</span><br><span class="line"></span><br><span class="line">kubectl get pod legacy-app -o yaml &gt; legacy-app2.yaml</span><br><span class="line">vim legacy-app2.yaml</span><br></pre></td></tr></table></figure>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">legacy-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">count</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox:1.28</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/bin/sh</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">-c</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&gt;</span></span><br><span class="line">      <span class="string">i=0;</span></span><br><span class="line">      <span class="string">while</span> <span class="literal">true</span><span class="string">;</span></span><br><span class="line">      <span class="string">do</span></span><br><span class="line">        <span class="string">echo</span> <span class="string">"$i: $(date)"</span> <span class="string">&gt;&gt;</span> <span class="string">/var/log/1.log;</span></span><br><span class="line">        <span class="string">echo</span> <span class="string">"$(date) INFO $i"</span> <span class="string">&gt;&gt;</span> <span class="string">/var/log/2.log;</span></span><br><span class="line">        <span class="string">i=$((i+1));</span></span><br><span class="line">        <span class="string">sleep</span> <span class="number">1</span><span class="string">;</span></span><br><span class="line">      <span class="string">done</span>      </span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">logs</span>          <span class="comment"># 3 修改挂载目录及名称</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/var/log</span> <span class="comment"># 3 修改挂载目录及名称</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span>  <span class="comment"># 1 Add sidecar container</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox</span> <span class="comment"># 1 Add sidecar container</span></span><br><span class="line">    <span class="attr">args:</span> <span class="string">[/bin/sh,</span> <span class="string">-c,</span> <span class="string">'tail -n+1 -f /var/log/legacy-app.log'</span><span class="string">]</span> <span class="comment"># 1 command</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">logs</span>          <span class="comment"># 2 添加vomuleMount挂载点</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/var/log</span> <span class="comment"># 2 注意是/var/log，不是/var/log/legacy-app.log</span></span><br><span class="line">  <span class="attr">volumes:</span>     </span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">logs</span> <span class="comment"># 3 添加volumes</span></span><br><span class="line">    <span class="attr">emptyDir:</span> <span class="string">&#123;&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除legacy-app，否则再运行yaml时会提示legacy-app已存在</span></span><br><span class="line">kubectl delete pod legacy-app -–force</span><br><span class="line">kubectl apply -f legacy-app2.yaml</span><br><span class="line">kubectl get pods | grep legacy-app</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="考题17-检查有多少-node-节点是健康状态">考题17-检查有多少 node 节点是健康状态</h2>
<h3 id="题目：检查有多少-node-节点是健康状态">题目：检查有多少 node 节点是健康状态</h3>
<p>Task weight: 4%<br>
Set configuration context:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[studentfnode-1] $ kubectl config use-context k8S</span><br></pre></td></tr></table></figure>
<h4 id="task-v17">Task</h4>
<p>Check to see how many nodes are ready (not including nodes tainted <code>NoSchedule</code> ) and write the number to <code>/opt/KUSC00402/kusc00402.txt</code></p>
<h3 id="解答：检查有多少-node-节点是健康状态">解答：检查有多少 node 节点是健康状态</h3>
<p>Search <code>Check to see how many nodes are ready</code>, 选择<a href="https://kubernetes.io/docs/tasks/debug/debug-cluster/#listing-your-cluster" target="_blank" rel="noopener">Troubleshooting Clusters</a></p>
<ul>
<li><a href="https://www.runoob.com/linux/linux-comm-grep.html" target="_blank" rel="noopener">Linux grep 命令</a></li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">kubectl config use-context k8s</span><br><span class="line"><span class="comment"># 1 查看STATUS是Ready的node有3个</span></span><br><span class="line">kubectl get nodes</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 查看Ready的那些node是否是NoSchedule</span></span><br><span class="line">kubectl describe nodes | grep Taint</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者一个一个看node是否是NoSchedule</span></span><br><span class="line"><span class="comment"># kubectl describe nodes k8s-master-0 | grep Taint</span></span><br><span class="line"><span class="comment">#     Taints: node-role.kubernetes.io/master:NoSchedule</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># kubectl describe nodes k8s-node-0 | grep Taint</span></span><br><span class="line"><span class="comment">#     Taints: &lt;none&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># kubectl describe nodes k8s-node-1 | grep Taint</span></span><br><span class="line"><span class="comment">#     Taints: &lt;none&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2 或者直接查看所有nodes里面不包含noschedule 并且是ready的共有几个，就是答案</span></span><br><span class="line"><span class="comment"># -i 或 --ignore-case : 忽略字符大小写的差别。-v 或 --invert-match : 显示不包含匹配文本的所有行。</span></span><br><span class="line"><span class="comment"># kubectl describe nodes | grep -i taints | grep -v -i noschedule </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3 输出 = node ready 个数 - NoSchedule 个数</span></span><br><span class="line"><span class="built_in">echo</span> 2 &gt; /opt/KUSC00402/kusc00402.txt</span><br></pre></td></tr></table></figure>
<hr>
<hr>
<h2 id="参考文章">参考文章</h2>
<ul>
<li><a href="https://blog.csdn.net/cum88284/article/details/109042737" target="_blank" rel="noopener">linux nano命令_Nano入门指南，Linux命令行文本编辑器</a></li>
<li><a href="https://itnext.io/cks-cka-ckad-changed-terminal-to-remote-desktop-157a26c1d5e" target="_blank" rel="noopener">CKS CKA CKAD changed Terminal to Remote Desktop since 06/2022</a></li>
<li><a href="https://blog.csdn.net/april_4/article/details/123233845" target="_blank" rel="noopener">2022年CKA 考试题 2022年3月1日刚过</a></li>
<li><a href="https://blog.csdn.net/qq_33680297/article/details/123074501" target="_blank" rel="noopener">2022.2 k8s-cka考试题库</a></li>
<li><a href="https://wenku.baidu.com/view/1d4a8bdbcbd376eeaeaad1f34693daef5ef713f4?bfetype=new" target="_blank" rel="noopener">CKA 百度文库</a></li>
<li><a href="https://www.mindmeister.com/zh/920845833/kubernauts-training-pla" target="_blank" rel="noopener">CKA Kubernauts Training Plan Mind 脑图</a><br>
<a href="https://zhuanlan.zhihu.com/p/106090560?utm_medium=social&amp;utm_oi=56834706636800&amp;utm_psn=1578894322392657920&amp;utm_source=wechat_session" target="_blank" rel="noopener">惊！2020年CKA考试最新最全指南</a></li>
<li><a href="https://huaweicloud.csdn.net/638db4c0dacf622b8df8cbb2.html" target="_blank" rel="noopener">如何在 K8S CKA、CKS 认证中失败！请仔细阅读，风险自负</a></li>
<li><a href="https://blog.csdn.net/shenhonglei1234/article/details/112670052?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167231074016782425181102%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=167231074016782425181102&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~rank_v31_ecpm-27-112670052-null-null.142%5Ev68%5Econtrol,201%5Ev4%5Eadd_ask,213%5Ev2%5Et3_control1&amp;utm_term=CKAD%20%E7%9C%9F%E9%A2%98&amp;spm=1018.2226.3001.4187#20221114CKANEW_5" target="_blank" rel="noopener">新版本 CKA 资源目录总览</a></li>
</ul>


                    <!-- Donate -->

<div>
    <div class="donate-container" style="padding: 10px 0; margin: auto auto; width: 90%; text-align: center;">
        <div></div>
        <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
        <span>Donate</span>
        </button>
        <div id="QR" style="display: none;">
            <div id="wechat" style="display: inline-block">
                <img id="wechat_qr" src="https://github.com/CatherineLiyuankun/PictureBed/raw/master/blog/base/wechat/wechatpay.png" alt="WeChat Pay" style="width: 200px; height: 200px; text-align: center;">
            <!-- <p>Wechat</p> -->
            </div>
            <div id="alipay" style="display: inline-block">
                <img id="alipay_qr" src="https://github.com/CatherineLiyuankun/PictureBed/raw/master/blog/base/alipay.png" alt="Alipay" style="width: 200px; height: 200px; text-align: center;">
            <!-- <p>Alipay</p> -->
            </div>
        </div>
    </div>
</div>


                    <! -- 添加版权信息 -->
<div class="article-footer-copyright">
  <div><b>本文标题: </b><a href="/Kubernates-Certified-Kubernetes-Administrator-CKA.html" target="_blank" title="2022年8月 CKA K8s v1.24 考试真题整理">2022年8月 CKA K8s v1.24 考试真题整理</a></div>
  <div><b>本文链接: </b><a href="/Kubernates-Certified-Kubernetes-Administrator-CKA.html" target="_blank" title="2022年8月 CKA K8s v1.24 考试真题整理">http://liyuankun.top/Kubernates-Certified-Kubernetes-Administrator-CKA.html</a>.</div>
  <div>本文由<a href="/index.html" target="_blank" title="Yuankun Li">Yuankun Li</a>创作和发表,采用<b>BY</b>-<b>NC</b>-<b>SA</b>国际许可协议进行许可,转载请注明作者及出处。</div>
</div>

                    
                    <hr>
                    <!-- Pager -->
                    <ul class="pager">
                        
                            <li class="previous">
                                <a href="/Kubernates-Certified-Kubernetes-Application-Developer-CKAD.html" rel="external nofollow" data-toggle="tooltip" data-placement="top" title="2022 CKAD K8s v1.25 考试真题整理">&larr; Previous Post</a>
                            </li>
                        
                        
                            <li class="next">
                                <a href="/Kubernates-upgrade.html" rel="external nofollow" data-toggle="tooltip" data-placement="top" title="Kubernates-upgrade">Next Post &rarr;</a>
                            </li>
                        
                    </ul>

                    <!-- Duoshuo Comment Share -->
                    

                    <!-- Duoshuo Comment -->
                    

                    <!-- Disqus Comment -->
                    <!-- disqus comment -->

    <div class="disqus_comment">
        <div id="disqus_thread" class="disqus-thread"></div>
    </div>


                    <!-- Git Comment -->
                    <!-- gitment -->

    <hr>
    <div class="git_comment" id="git_comment">
        
            <div onclick="document.getElementById('gitment-display-button').style.display = 'none';document.getElementById('gitment-container').style.display = 'block';renderGitment();" id="gitment-display-button">show git comment</div>
            <div id="gitment-container" style="display:none"></div>
        
    </div>
    <hr>

                </div>
                
                <!-- Tabe of Content -->
                <!-- Table of Contents -->

    
      <aside id="sidebar">
        <div id="toc" class="toc-article">
        <strong class="toc-title">Contents</strong>
        
          <ol class="toc-nav"><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#考试内容"><span class="toc-nav-number">1.</span> <span class="toc-nav-text">考试内容</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#cka-preparation"><span class="toc-nav-number">1.1.</span> <span class="toc-nav-text">CKA Preparation</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#如何备考"><span class="toc-nav-number">2.</span> <span class="toc-nav-text">如何备考</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#k8s练习环境"><span class="toc-nav-number">2.1.</span> <span class="toc-nav-text">k8s练习环境</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#本地环境-minikube"><span class="toc-nav-number">2.1.1.</span> <span class="toc-nav-text">本地环境-Minikube</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#在线环境-killercoda"><span class="toc-nav-number">2.1.2.</span> <span class="toc-nav-text">在线环境-killercoda</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#cka课程"><span class="toc-nav-number">2.2.</span> <span class="toc-nav-text">CKA课程</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#经验总结"><span class="toc-nav-number">3.</span> <span class="toc-nav-text">经验总结</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#常用官方文档链接"><span class="toc-nav-number">3.1.</span> <span class="toc-nav-text">常用官方文档链接</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#pre-setup"><span class="toc-nav-number">4.</span> <span class="toc-nav-text">Pre Setup</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#kubectl-设置"><span class="toc-nav-number">4.1.</span> <span class="toc-nav-text">kubectl 设置</span></a></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#vim-设置"><span class="toc-nav-number">4.2.</span> <span class="toc-nav-text">Vim 设置</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#vim基本操作"><span class="toc-nav-number">4.2.1.</span> <span class="toc-nav-text">Vim基本操作</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#使用nano编辑器"><span class="toc-nav-number">4.3.</span> <span class="toc-nav-text">使用nano编辑器</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#考题1-rbac"><span class="toc-nav-number">5.</span> <span class="toc-nav-text">考题1-RBAC</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#rbac题目"><span class="toc-nav-number">5.1.</span> <span class="toc-nav-text">RBAC题目</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#context"><span class="toc-nav-number">5.1.1.</span> <span class="toc-nav-text">Context</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#task"><span class="toc-nav-number">5.1.2.</span> <span class="toc-nav-text">Task</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#rbac解答"><span class="toc-nav-number">5.2.</span> <span class="toc-nav-text">RBAC解答</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#考题2-创建-networkpolicy"><span class="toc-nav-number">6.</span> <span class="toc-nav-text">考题2-创建 NetworkPolicy</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#题目：networkpolicy"><span class="toc-nav-number">6.1.</span> <span class="toc-nav-text">题目：NetworkPolicy</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#task-v2"><span class="toc-nav-number">6.1.1.</span> <span class="toc-nav-text">Task</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#解答：networkpolicy"><span class="toc-nav-number">6.2.</span> <span class="toc-nav-text">解答：NetworkPolicy</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#考题3-创建-svc"><span class="toc-nav-number">7.</span> <span class="toc-nav-text">考题3-创建 svc</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#题目：创建-svc"><span class="toc-nav-number">7.1.</span> <span class="toc-nav-text">题目：创建 svc</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#task-v3"><span class="toc-nav-number">7.1.1.</span> <span class="toc-nav-text">Task</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#解答：创建-svc"><span class="toc-nav-number">7.2.</span> <span class="toc-nav-text">解答：创建 svc</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#考题4-创建-ingress-资源"><span class="toc-nav-number">8.</span> <span class="toc-nav-text">考题4-创建 ingress 资源</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#题目：ingress"><span class="toc-nav-number">8.1.</span> <span class="toc-nav-text">题目：ingress</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#task-v4"><span class="toc-nav-number">8.1.1.</span> <span class="toc-nav-text">Task</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#解答：ingress"><span class="toc-nav-number">8.2.</span> <span class="toc-nav-text">解答：ingress</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#考题5-扩展-deployment"><span class="toc-nav-number">9.</span> <span class="toc-nav-text">考题5-扩展 deployment</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#题目：扩展-deployment"><span class="toc-nav-number">9.1.</span> <span class="toc-nav-text">题目：扩展 deployment</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#task-v5"><span class="toc-nav-number">9.1.1.</span> <span class="toc-nav-text">Task</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#解答：扩展-deployment"><span class="toc-nav-number">9.2.</span> <span class="toc-nav-text">解答：扩展 deployment</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#考题6-将-pod-部署到指定-node-节点上"><span class="toc-nav-number">10.</span> <span class="toc-nav-text">考题6-将 pod 部署到指定 node 节点上</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#题目：将-pod-部署到指定-node-节点上"><span class="toc-nav-number">10.1.</span> <span class="toc-nav-text">题目：将 pod 部署到指定 node 节点上</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#task-v6"><span class="toc-nav-number">10.1.1.</span> <span class="toc-nav-text">Task</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#解答：将-pod-部署到指定-node-节点上"><span class="toc-nav-number">10.2.</span> <span class="toc-nav-text">解答：将 pod 部署到指定 node 节点上</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#考题7-kubernates-upgrade"><span class="toc-nav-number">11.</span> <span class="toc-nav-text">考题7-Kubernates-upgrade</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#题目：-kubernates-upgrade"><span class="toc-nav-number">11.1.</span> <span class="toc-nav-text">题目： Kubernates-upgrade</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#task-v7"><span class="toc-nav-number">11.1.1.</span> <span class="toc-nav-text">Task</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#解答：升级master"><span class="toc-nav-number">11.2.</span> <span class="toc-nav-text">解答：升级master</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#考题8-etcd-备份还原"><span class="toc-nav-number">12.</span> <span class="toc-nav-text">考题8-etcd 备份还原</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#题目：etcd-备份还原"><span class="toc-nav-number">12.1.</span> <span class="toc-nav-text">题目：etcd 备份还原</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#task-v8"><span class="toc-nav-number">12.1.1.</span> <span class="toc-nav-text">Task</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#解答"><span class="toc-nav-number">12.2.</span> <span class="toc-nav-text">解答</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#考题9-创建多个-container-的-pod"><span class="toc-nav-number">13.</span> <span class="toc-nav-text">考题9-创建多个 container 的 Pod</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#题目：创建多个-container-的-pod"><span class="toc-nav-number">13.1.</span> <span class="toc-nav-text">题目：创建多个 container 的 Pod</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#task-v9"><span class="toc-nav-number">13.1.1.</span> <span class="toc-nav-text">Task</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#解答：创建多个-container-的-pod"><span class="toc-nav-number">13.2.</span> <span class="toc-nav-text">解答：创建多个 container 的 Pod</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#考题10-创建-persistent-volume"><span class="toc-nav-number">14.</span> <span class="toc-nav-text">考题10-创建 Persistent Volume</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#题目：创建-persistent-volume"><span class="toc-nav-number">14.1.</span> <span class="toc-nav-text">题目：创建 Persistent Volume</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#task-v10"><span class="toc-nav-number">14.1.1.</span> <span class="toc-nav-text">Task</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#解答：创建-persistent-volume"><span class="toc-nav-number">14.2.</span> <span class="toc-nav-text">解答：创建 Persistent Volume</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#考题11-创建-pvc"><span class="toc-nav-number">15.</span> <span class="toc-nav-text">考题11-创建 PVC</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#题目：创建-pvc"><span class="toc-nav-number">15.1.</span> <span class="toc-nav-text">题目：创建 PVC</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#task-v11"><span class="toc-nav-number">15.1.1.</span> <span class="toc-nav-text">Task</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#解答：创建-pvc"><span class="toc-nav-number">15.2.</span> <span class="toc-nav-text">解答：创建 PVC</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#考题12-设置node-unavailable"><span class="toc-nav-number">16.</span> <span class="toc-nav-text">考题12-设置node unavailable</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#题目：设置node-unavailable"><span class="toc-nav-number">16.1.</span> <span class="toc-nav-text">题目：设置node unavailable</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#task-v12"><span class="toc-nav-number">16.1.1.</span> <span class="toc-nav-text">Task</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#解答：设置node-unavailable"><span class="toc-nav-number">16.2.</span> <span class="toc-nav-text">解答：设置node unavailable</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#考题13-监控-pod-的日志"><span class="toc-nav-number">17.</span> <span class="toc-nav-text">考题13-监控 pod 的日志</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#题目：监控-pod-的日志"><span class="toc-nav-number">17.1.</span> <span class="toc-nav-text">题目：监控 pod 的日志</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#task-v13"><span class="toc-nav-number">17.1.1.</span> <span class="toc-nav-text">Task</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#解答：监控-pod-的日志"><span class="toc-nav-number">17.2.</span> <span class="toc-nav-text">解答：监控 pod 的日志</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#考题14-查看最高-cpu-使用率的-pod"><span class="toc-nav-number">18.</span> <span class="toc-nav-text">考题14-查看最高 CPU 使用率的 Pod</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#题目：查看最高-cpu-使用率的-pod"><span class="toc-nav-number">18.1.</span> <span class="toc-nav-text">题目：查看最高 CPU 使用率的 Pod</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#task-v14"><span class="toc-nav-number">18.1.1.</span> <span class="toc-nav-text">Task</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#解答：查看最高-cpu-使用率的-pod"><span class="toc-nav-number">18.2.</span> <span class="toc-nav-text">解答：查看最高 CPU 使用率的 Pod</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#考题15-集群故障排查"><span class="toc-nav-number">19.</span> <span class="toc-nav-text">考题15-集群故障排查</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#题目：集群故障排查"><span class="toc-nav-number">19.1.</span> <span class="toc-nav-text">题目：集群故障排查</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#task-v15"><span class="toc-nav-number">19.1.1.</span> <span class="toc-nav-text">Task</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#解答：集群故障排查"><span class="toc-nav-number">19.2.</span> <span class="toc-nav-text">解答：集群故障排查</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#考题16-添加-sidecar-container"><span class="toc-nav-number">20.</span> <span class="toc-nav-text">考题16-添加 sidecar container</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#题目：添加-sidecar-container"><span class="toc-nav-number">20.1.</span> <span class="toc-nav-text">题目：添加 sidecar container</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#context-v2"><span class="toc-nav-number">20.1.1.</span> <span class="toc-nav-text">Context</span></a></li><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#task-v16"><span class="toc-nav-number">20.1.2.</span> <span class="toc-nav-text">Task</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#解答：添加-sidecar-container"><span class="toc-nav-number">20.2.</span> <span class="toc-nav-text">解答：添加 sidecar container</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#考题17-检查有多少-node-节点是健康状态"><span class="toc-nav-number">21.</span> <span class="toc-nav-text">考题17-检查有多少 node 节点是健康状态</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#题目：检查有多少-node-节点是健康状态"><span class="toc-nav-number">21.1.</span> <span class="toc-nav-text">题目：检查有多少 node 节点是健康状态</span></a><ol class="toc-nav-child"><li class="toc-nav-item toc-nav-level-4"><a class="toc-nav-link" href="#task-v17"><span class="toc-nav-number">21.1.1.</span> <span class="toc-nav-text">Task</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-3"><a class="toc-nav-link" href="#解答：检查有多少-node-节点是健康状态"><span class="toc-nav-number">21.2.</span> <span class="toc-nav-text">解答：检查有多少 node 节点是健康状态</span></a></li></ol></li><li class="toc-nav-item toc-nav-level-2"><a class="toc-nav-link" href="#参考文章"><span class="toc-nav-number">22.</span> <span class="toc-nav-text">参考文章</span></a></li></ol>
        
        </div>
      </aside>
    

                    
                <!-- Sidebar Container Below-->
                <div class="
    col-lg-8 col-lg-offset-2
    col-md-10 col-md-offset-1
    sidebar-container">
    
        
    
        
    
        
    
        
            
  <h5>RECENT POSTS</h5>
  <div class="widget">
    <ul>
      
        <li>
          <a href="/awesome-tools.html">程序猿的那些好用工具</a>
        </li>
      
        <li>
          <a href="/计算机英语-virus-worm-Spyware-Ransomware-Trojan-horse.html">计算机英语-virus,worm,Spyware,Ransomware,Trojan horse</a>
        </li>
      
        <li>
          <a href="/浏览器报错“localhost-sent-an-invalid-response-ERR-SSL-PROTOCOL-ERROR”.html">浏览器报错“localhost sent an invalid response.ERR_SSL_PROTOCOL_ERROR”</a>
        </li>
      
        <li>
          <a href="/JSON-Web-Token-JWT-入门教程.html">JSON Web Token (JWT) 入门教程</a>
        </li>
      
        <li>
          <a href="/Develop-LLM-powered-applications-with-LangChain-Udemy-Course.html">Develop LLM powered applications with LangChain - Udemy Course</a>
        </li>
      
    </ul>
  </div>

            <hr>
        
    
        
            <!-- Friends Blog -->

<h5>FRIENDS</h5>
<ul class="list-inline">

    
        <li><a href="https://blog.csdn.net/muzilanlan" target="_blank">CSDN</a></li>
    
        <li><a href="https://www.jianshu.com/u/6b421fa23669" target="_blank">简书</a></li>
    
</ul>

            <hr>
        
    
        
    
</div>
            </div>
        </div>
    </article>
</div>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("https://cdn.bootcss.com/anchor-js/1.1.1/anchor.min.js",function(){
        anchors.options = {
          visible: 'hover',
          placement: 'left',
          icon: 'ℒ'
        };
        anchors.add().remove('.intro-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<!-- Read more, 微信解锁博客 https://openwrite.cn/openwrite/openwrite-readmore/-->
<script src="https://my.openwrite.cn/js/readmore.js" type="text/javascript"></script>
<script>
    const btw = new BTWPlugin();
    btw.init({
        id: 'container',
        blogId: '19965-1582033785898-401',
        name: '岚坤爷',
        qrcode: 'https://github.com/CatherineLiyuankun/PictureBed/raw/master/blog/base/wechat/wechat-public.png',
        keyword: 'vip',
    });
    // 加英文版翻译
    const readMoreBtn = document.querySelector('#read-more-btn');
    const addEnglish = () => {
        const element = document.querySelector('#btw-modal-header');
        element.innerHTML = element.innerHTML + `<p id="btw-modal-header-en" style="margin-top: 10px; line-height: 1.8; font-size: 13px; color: #0085a1;">
            Scan the QR code to follow the WeChat public account: <strong>岚坤爷</strong><br>
            Send message:<strong> vip</strong><br>
            Get a verification code that permanently unlocks all articles on this site`;
        const input = document.querySelector('#btw-modal-input');
        input.setAttribute('placeholder', '请输入验证码 Input verification code');
        const submit = document.querySelector('#btw-submit-btn');
        submit.innerHTML = '提交 Submit';
    };

    readMoreBtn.addEventListener('click', () => {
        setTimeout(addEnglish, 10);
    });
</script>

<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- Footer -->
    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-1 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                
                    <li>
                        <a href="/atom.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank"  href="https://github.com/catherineliyuankun">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank"  href="https://www.linkedin.com/in/liyuankun">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://www.zhihu.com/people/muzilan">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">知</i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://www.jianshu.com/u/6b421fa23669">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa  fa-stack-1x fa-inverse">简</i>
                            </span>
                        </a>
                    </li>
                

                

                
                    <li>
                        <a target="_blank" href="mailto:muzilan1@qq.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://twitter.com/CatherineLiYK">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                
                    <li>
                        <a target="_blank" href="https://www.facebook.com/liyuankun">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                

                </ul>
                <p class="copyright text-muted">
                    Copyright &copy; Yuankun Li 2025 
                    <br>
                    Theme by <a href="https://github.com/CatherineLiyuankun">Li, Yuankun</a> | 
                    <iframe
                        style="margin-left: 2px; margin-bottom:-5px;"
                        frameborder="0" scrolling="0" width="91px" height="20px"
                        src="https://ghbtns.com/github-btn.html?user=catherineliyuankun&repo=hexo-theme-zilan&type=star&count=true" >
                    </iframe>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js"></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js"></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.min.js"></script>


<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/    
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async("http://liyuankun.top/js/jquery.tagcloud.js",function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("https://cdn.bootcss.com/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->


<script>
    // dynamic User by Hux
    var _gaId = 'UA-XXXXXXXX-X';
    var _gaDomain = 'yoursite';

    // Originial
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', _gaId, _gaDomain);
    ga('send', 'pageview');
</script>




<!-- Baidu Tongji -->





    <!-- Fork me on GitHub -->
    
       
    <!-- Search -->
    <!-- {% include 'tinysou.swig' %}
 {% include 'localsearch.swig' %}
 {% include 'algolia-search/assets.swig' %} -->


  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = 'search.xml';
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = '/' + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        // dataType: isXml ? "xml" : "json",
        // dataType: "binary",
        // contentType: "text/xml",
        dataType: "text", // Fix Bug: xml parser error
        async: true,
        data: "{}",
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-cover');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if (!input || !resultContent) {
            // Fix Bug: add /zilan/layout/_partial/search/localsearch.ejs inside "site-search"
              $(".site-search")
              .append(
                  '<div class="popup search-popup local-search-popup">' +
                  '<div class="local-search-header clearfix">' +
                    '<span class="search-icon">' +
                      '<i class="fa fa-search"></i>' +
                  '</span>' +
                    '<span class="popup-btn-close">' +
                      '<i class="fa fa-times-circle"></i>' +
                    '</span>' +
                    '<div class="local-search-input-wrapper">' +
                      '<input autocomplete="off"' +
                            'placeholder="search" spellcheck="false"' +
                            'type="text" id="local-search-input">' +
                    '</div>' +
                  '</div>' +
                  '<div id="local-search-result"></div>' +
                '</div>');
            input = document.getElementById("local-search-input");
            resultContent = document.getElementById("local-search-result");
            // Fix Bug: close not work
            var searchClose = document.querySelector(".popup-btn-close");
            searchClose.addEventListener('click', onPopupClose);
          }
          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        },
        error: function (jqXHR, textStatus, errorThrown) {
            /*弹出jqXHR对象的信息*/
            alert(jqXHR.responseText);
            alert(jqXHR.status);
            alert(jqXHR.readyState);
            alert(jqXHR.statusText);
            /*弹出其他两个参数的信息*/
            alert(textStatus);
            alert(errorThrown);
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });

    var registerESCKeyEvent =  function () {
      $(document).on('keyup', function (event) {
        var shouldDismissSearchPopup = event.which === 27 &&
          $('.search-popup').is(':visible');
        if (shouldDismissSearchPopup) {
          $('.search-popup').hide();
          $('.search-popup-overlay').remove();
          $('body').css('overflow', '');
        }
      });
    };
    registerESCKeyEvent();
  </script>





    <!-- Share -->
      
    <link rel="stylesheet" href="/lib/needsharebutton/needsharebutton.css">
    <script src="/lib/needsharebutton/needsharebutton.js"></script>

    
      <script>
          var pbOptions = {};
          var iconStyle = "light";
          var boxForm = "horizontal";
          var position = "bottom";
          var networks = "Wechat,Weibo,Douban,Twitter,Facebook,Reddit,Linkedin,Evernote";
          pbOptions["iconStyle"] = iconStyle;
          pbOptions["boxForm"] = boxForm;
          pbOptions["position"] = position;
          pbOptions["networks"] = networks;
          
          new needShareButton('#needsharebutton-postbottom', pbOptions);
      </script>
    

    
      <script>
          var pbOptions = {};
          var iconStyle = "light";
          var boxForm = "horizontal";
          var position = "middleRight";
          var networks = "Wechat,Weibo,Douban,Twitter,Facebook,Reddit,Linkedin,Evernote";
          pbOptions["iconStyle"] = iconStyle;
          pbOptions["boxForm"] = boxForm;
          pbOptions["position"] = position;
          pbOptions["networks"] = networks;
          
          new needShareButton('#needsharebutton-postbottom', pbOptions);
      </script>
    

    
      <script>
          var flOptions = {};
          var iconStyle = "box";
          var boxForm = "horizontal";
          var position = "middleRight";
          var networks = "Wechat,Weibo,Douban,Twitter,Facebook,Reddit,Linkedin,Evernote";
          flOptions["iconStyle"] = iconStyle;
          flOptions["boxForm"] = boxForm;
          flOptions["position"] = position;
          flOptions["networks"] = networks;

          new needShareButton('#needsharebutton-float', flOptions);
      </script>
    


    <!-- Share float -->
    
      <div id="needsharebutton-float">
        <span class="btn">
          <i class="fa fa-share-alt fa-inverse" aria-hidden="true"></i>
        </span>
      </div>
      

    <!-- Git Comment -->
    
    
    <!-- LOCAL: You can save these files to your site and update links -->
        
            <link rel="stylesheet" href="https://aimingoo.github.io/gitmint/style/default.css">
            <script src="https://aimingoo.github.io/gitmint/dist/gitmint.browser.js"></script>
        
    <!-- END LOCAL -->
        
        <style>
            a.gitment-editor-footer-tip { display: none; }
            .gitment-container.gitment-footer-container { display: none; }
        </style>
        

        
        <script type="text/javascript">
            var option = {
                id: window.location.pathname,
                owner: 'CatherineLiyuankun',
                repo: 'gitment-comments',
                oauth: {
                    client_id: 'f3a0c1c7153576e1ab6c'
                }
            };
            if(true) {
                option.lang = "" || navigator.language || navigator.systemLanguage || navigator.userLanguage;
            }
            if (true && ( || false)) {
                option.oauth.redirect_protocol = '';
            }
            if (true && ( || false)) {
                option.oauth.proxy_gateway = '';
            } else {
                option.oauth.client_secret = 'bedf5010df925fa0e02e8be9399a64caac3d2b4e';
            }

            function renderGitment(){
                var gitment;
                if (true) {
                    gitment = new Gitmint(option);
                } else {
                    gitment = new Gitment(option);
                }
                gitment.render('gitment-container');
            }

            if(!true) {
                renderGitment();
            } else {
                function showGitment(){
                    document.getElementById("gitment-display-button").style.display = "none";
                    document.getElementById("gitment-container").style.display = "block";
                    renderGitment();
                }
            }
        </script>
        
    



    <!-- Disqus Comment -->
    
    <!-- disqus embedded js code start (one page only need to embed once) -->
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES * * */
        var disqus_shortname = "lyk-1";
        var disqus_identifier = "http://liyuankun.top/Kubernates-Certified-Kubernetes-Administrator-CKA.html";
        var disqus_url = "http://liyuankun.top/Kubernates-Certified-Kubernetes-Administrator-CKA.html";

        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();

    </script>
    <!-- disqus embedded js code start end -->

    
    <!-- Duoshuo Comment -->
    

    <!-- Search popup-->
    
    
      <div class="site-search">
      <!-- {% if theme.algolia_search.enable %}
  {% include '../_third-party/search/algolia-search/dom.swig' %}
{% elseif theme.swiftype_key %}
  {% include 'search/swiftype.swig' %}
{% elseif theme.tinysou_Key %}
  {% include 'search/tinysou.swig' %}
{% elseif theme.local_search.enable %}
  {% include 'search/localsearch.swig' %}
{% endif %} -->

<div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="search" spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



      </div>
    
    
	<a id="rocket" href="#top" class="" rel="external nofollow"></a>
	<script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  <script type="text/javascript" src="/js/toc.js?v=1.0.0" async=""></script>

  <!-- Markdown math -->
   
   
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  



  <!-- Fancybox -->
  
      <link rel="stylesheet" href="/lib/fancybox/jquery.fancybox.css">
      <script src="/lib/fancybox/jquery.fancybox.pack.js"></script>
      <script src="/js/wrapImage.js"></script>
  
  <!-- Migrate from head to bottom, no longer block render and still work --><!-- hexo-inject:begin --><!-- Begin: Injected MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({"tex2jax":{"inlineMath":[["$","$"],["\\(","\\)"]],"skipTags":["script","noscript","style","textarea","pre","code"],"processEscapes":true},"TeX":{"equationNumbers":{"autoNumber":"AMS"}}});
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js">
</script>
<!-- End: Injected MathJax -->
<!-- hexo-inject:end -->

</body>

</html>
